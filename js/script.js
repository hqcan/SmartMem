// Language translations
const translations = {
    zh: {
        title: "智能记忆助手 - SmartMem",
        meta_description: "SmartMem是一款智能记忆助手APP，帮助您高效学习和记忆",
        nav_home: "首页",
        nav_features: "功能",
        nav_download: "下载",
        nav_support: "支持",
        logo_text: "智能记忆助手",
        hero_title: "智能记忆，高效学习",
        hero_subtitle: "SmartMem运用先进的记忆算法，帮助您更好地学习和记忆知识",
        btn_download: "立即下载",
        btn_learn_more: "了解更多",
        features_title: "核心功能",
        features_subtitle: "为您提供最佳的学习体验",
        feature1_title: "智能算法",
        feature1_desc: "科学的记忆算法，智能安排复习时间",
        feature2_title: "学习统计",
        feature2_desc: "详细的学习进度和成果统计分析",
        feature3_title: "云端同步",
        feature3_desc: "多设备数据同步，随时随地学习",
        feature4_title: "个性化",
        feature4_desc: "多种主题和个性化设置选项",
        feature5_title: "智能提醒",
        feature5_desc: "智能复习提醒系统，不错过最佳记忆时机",
        feature6_title: "小组件支持",
        feature6_desc: "桌面小组件，随时查看学习进度",
        download_title: "立即下载",
        download_subtitle: "在您的设备上开始智能学习之旅",
        footer_desc: "智能记忆助手，让学习更高效",
        footer_links: "快速链接",
        footer_privacy: "隐私政策",
        footer_terms: "服务条款",
        footer_subscription: "订阅协议",
        footer_support: "技术支持",
        footer_rights: "保留所有权利",
        // Pricing translations
        privacy_subscription_title: "订阅服务信息",
        privacy_subscription_content: "SmartMem提供年度订阅服务：",
        pricing_plans_title: "订阅计划和价格",
        pricing_yearly: "年度订阅：¥128/年 ($19.9/年)",
        pricing_note: "* 价格可能因地区而异，以App Store显示的当地货币价格为准。订阅将自动续费，可随时取消。",
        // Page titles
        privacy_title: "隐私政策 - 智能记忆助手",
        terms_title: "服务条款 - 智能记忆助手",
        subscription_title: "订阅协议 - 智能记忆助手",
        support_title: "技术支持 - 智能记忆助手",
        // Support page translations
        support_meta_desc: "SmartMem技术支持，获取帮助和解决问题",
        support_hero_title: "帮助中心",
        support_hero_subtitle: "查找常见问题的解答和使用指南",
        faq_title: "常见问题",
        faq_q1: "如何开始使用SmartMem？",
        faq_a1: "下载并安装SmartMem应用后，您可以立即开始使用。应用不需要注册账户，所有数据都存储在您的设备上。",
        faq_q2: "如何添加学习内容？",
        faq_a2: "在主界面点击"+"按钮，输入您想要记忆的内容。您可以添加文字、图片等多种形式的学习材料。",
        faq_q3: "什么是智能复习提醒？",
        faq_a3: "SmartMem使用科学的记忆算法，智能计算最佳复习时间，在合适的时机提醒您复习，提高记忆效率。",
        faq_q4: "年度订阅包含哪些功能？",
        faq_a4: "年度订阅（¥128/年）包含：无限制添加学习内容、高级记忆算法、详细学习统计、多种主题选择、桌面小组件等高级功能。",
        faq_q5: "如何取消订阅？",
        faq_a5: "您可以在iPhone的设置 > Apple ID > 订阅中管理您的SmartMem订阅，随时取消。取消后您仍可使用高级功能直到当前计费周期结束。",
        faq_q6: "数据会丢失吗？",
        faq_a6: "您的学习数据安全存储在设备上，并通过iCloud自动备份。即使更换设备，您的数据也会自动恢复。",
        faq_q7: "支持哪些设备？",
        faq_a7: "SmartMem支持iPhone和iPad，需要iOS 14.0或更高版本。同时支持桌面小组件功能。",
        faq_q8: "如何使用桌面小组件？",
        faq_a8: "长按iPhone桌面空白处，点击左上角"+"号，搜索SmartMem，选择合适的小组件尺寸添加到桌面即可。",
        usage_guide_title: "使用指南",
        guide_getting_started: "快速开始",
        guide_getting_started_desc: "下载应用后即可立即使用，无需注册。点击"+"添加您的第一个学习内容。",
        guide_smart_review: "智能复习",
        guide_smart_review_desc: "应用会根据科学算法自动安排复习时间，按时复习可以显著提高记忆效果。",
        guide_statistics: "学习统计",
        guide_statistics_desc: "查看详细的学习进度和统计数据，了解您的学习效果和改进方向。",
        guide_widgets: "桌面小组件",
        guide_widgets_desc: "添加桌面小组件，无需打开应用即可查看今日复习任务和学习进度。",
        guide_themes: "个性化主题",
        guide_themes_desc: "选择您喜欢的主题风格，让学习界面更符合个人喜好，提升使用体验。",
        guide_backup: "数据备份",
        guide_backup_desc: "通过iCloud自动备份学习数据，换设备时数据无缝同步，学习进度永不丢失。",
        // Privacy Policy translations
        privacy_title: "隐私政策 - 智能记忆助手",
        privacy_meta_desc: "SmartMem隐私政策，了解我们如何保护您的个人信息",
        privacy_intro_title: "引言",
        privacy_intro_content: "SmartMem（\"我们\"、\"我们的\"或\"本应用\"）非常重视您的隐私。本隐私政策说明了我们的数据处理方式。SmartMem是一款完全本地化的应用，我们不收集、存储或传输您的任何个人信息。",
        privacy_no_collection_title: "我们不收集任何信息",
        privacy_no_collection_content: "SmartMem设计为完全本地化的应用程序，这意味着：",
        privacy_no_personal: "我们不收集任何个人身份信息",
        privacy_no_account: "应用无需注册账户或提供个人信息",
        privacy_no_analytics: "我们不收集使用统计或分析数据",
        privacy_no_tracking: "我们不跟踪您的使用行为",
        privacy_no_ads: "应用内无广告，无第三方跟踪",
        privacy_local_storage_title: "本地数据存储",
        privacy_local_storage_content: "您的所有学习数据都安全存储在您的设备上：",
        privacy_local_only: "所有学习内容和进度仅存储在您的设备本地",
        privacy_icloud_backup: "通过iOS系统的iCloud备份功能自动备份（由Apple管理）",
        privacy_no_server: "我们没有服务器存储您的任何数据",
        privacy_full_control: "您完全控制自己的数据",
        privacy_no_sharing_title: "无信息共享",
        privacy_no_sharing_content: "由于我们不收集任何信息，因此：",
        privacy_no_third_party: "我们不与任何第三方共享数据",
        privacy_no_selling: "我们不出售任何用户信息",
        privacy_no_marketing: "我们不用于营销目的",
        privacy_apple_only: "订阅信息仅由Apple处理和管理",
        privacy_security_title: "数据安全",
        privacy_security_content: "由于所有数据都存储在您的设备本地，您的信息安全取决于您设备的安全设置。我们建议保持设备更新并使用适当的安全措施。",
        privacy_rights_title: "您的权利",
        privacy_rights_content: "由于我们不收集任何个人信息，传统的数据权利（访问、更正、删除）不适用。但是，您对存储在设备本地的所有数据拥有完全控制权。",
        privacy_changes_title: "政策变更",
        privacy_changes_content: "我们可能会不时更新本隐私政策。重大变更将通过应用内通知或电子邮件通知您。",
        privacy_subscription_title: "订阅服务信息",
        privacy_subscription_content: "SmartMem提供年度订阅服务：",
        pricing_plans_title: "订阅计划和价格",
        pricing_yearly: "年度订阅：¥128/年 ($19.9/年)",
        pricing_note: "* 价格可能因地区而异，以App Store显示的当地货币价格为准。订阅将自动续费，可随时取消。订阅信息完全由Apple管理，我们无法访问您的付费信息。"
    },
    en: {
        title: "SmartMem - Intelligent Memory Assistant",
        meta_description: "SmartMem is an intelligent memory assistant app that helps you learn and memorize efficiently",
        nav_home: "Home",
        nav_features: "Features",
        nav_download: "Download",
        nav_support: "Support",
        logo_text: "SmartMem",
        hero_title: "Smart Memory, Efficient Learning",
        hero_subtitle: "SmartMem uses advanced memory algorithms to help you learn and memorize knowledge better",
        btn_download: "Download Now",
        btn_learn_more: "Learn More",
        features_title: "Core Features",
        features_subtitle: "Providing you with the best learning experience",
        feature1_title: "Smart Algorithm",
        feature1_desc: "Scientific memory algorithms that intelligently schedule review times",
        feature2_title: "Learning Statistics",
        feature2_desc: "Detailed learning progress and achievement statistics",
        feature3_title: "Cloud Sync",
        feature3_desc: "Multi-device data synchronization, learn anytime, anywhere",
        feature4_title: "Personalization",
        feature4_desc: "Multiple themes and personalization options",
        feature5_title: "Smart Reminders",
        feature5_desc: "Intelligent review reminder system, never miss the optimal memory timing",
        feature6_title: "Widget Support",
        feature6_desc: "Desktop widgets to check learning progress anytime",
        download_title: "Download Now",
        download_subtitle: "Start your intelligent learning journey on your device",
        footer_desc: "Intelligent memory assistant for more efficient learning",
        footer_links: "Quick Links",
        footer_privacy: "Privacy Policy",
        footer_terms: "Terms of Service",
        footer_subscription: "Subscription Agreement",
        footer_support: "Technical Support",
        footer_rights: "All rights reserved",
        // Pricing translations
        privacy_subscription_title: "Subscription Service Information",
        privacy_subscription_content: "SmartMem offers annual subscription service:",
        pricing_plans_title: "Subscription Plans and Pricing",
        pricing_yearly: "Annual Subscription: ¥128/year ($19.9/year)",
        pricing_note: "* Prices may vary by region. Actual prices are subject to App Store display in local currency. Subscriptions auto-renew and can be cancelled anytime.",
        // Page titles
        privacy_title: "Privacy Policy - SmartMem",
        terms_title: "Terms of Service - SmartMem",
        subscription_title: "Subscription Agreement - SmartMem",
        support_title: "Technical Support - SmartMem",
        // Support page translations
        support_meta_desc: "SmartMem Technical Support - Get help and solve problems",
        support_hero_title: "Help Center",
        support_hero_subtitle: "Find answers to common questions and usage guides",
        faq_title: "Frequently Asked Questions",
        faq_q1: "How do I get started with SmartMem?",
        faq_a1: "After downloading and installing the SmartMem app, you can start using it immediately. No account registration required, all data is stored on your device.",
        faq_q2: "How do I add learning content?",
        faq_a2: "Tap the '+' button on the main interface and enter the content you want to memorize. You can add various forms of learning materials including text and images.",
        faq_q3: "What is smart review reminder?",
        faq_a3: "SmartMem uses scientific memory algorithms to intelligently calculate optimal review times, reminding you to review at the right moment, improving memory efficiency.",
        faq_q4: "What features are included in the annual subscription?",
        faq_a4: "Annual subscription (¥128/year) includes: unlimited learning content, advanced memory algorithms, detailed learning statistics, multiple theme choices, desktop widgets, and other premium features.",
        faq_q5: "How do I cancel my subscription?",
        faq_a5: "You can manage your SmartMem subscription in iPhone Settings > Apple ID > Subscriptions and cancel anytime. You'll continue to have access to premium features until the current billing period ends.",
        faq_q6: "Will my data be lost?",
        faq_a6: "Your learning data is safely stored on your device and automatically backed up through iCloud. Even when switching devices, your data will be automatically restored.",
        faq_q7: "Which devices are supported?",
        faq_a7: "SmartMem supports iPhone and iPad, requiring iOS 14.0 or later. Desktop widget functionality is also supported.",
        faq_q8: "How do I use desktop widgets?",
        faq_a8: "Long press on your iPhone home screen, tap the '+' in the top left corner, search for SmartMem, and select the appropriate widget size to add to your home screen.",
        usage_guide_title: "Usage Guide",
        guide_getting_started: "Quick Start",
        guide_getting_started_desc: "Start using immediately after downloading, no registration required. Tap '+' to add your first learning content.",
        guide_smart_review: "Smart Review",
        guide_smart_review_desc: "The app automatically schedules review times based on scientific algorithms. Timely reviews can significantly improve memory effectiveness.",
        guide_statistics: "Learning Statistics",
        guide_statistics_desc: "View detailed learning progress and statistical data to understand your learning effectiveness and areas for improvement.",
        guide_widgets: "Desktop Widgets",
        guide_widgets_desc: "Add desktop widgets to check today's review tasks and learning progress without opening the app.",
        guide_themes: "Personalized Themes",
        guide_themes_desc: "Choose your favorite theme style to make the learning interface more suited to your personal preferences and enhance user experience.",
        guide_backup: "Data Backup",
        guide_backup_desc: "Automatically backup learning data through iCloud, seamlessly sync data when switching devices, never lose learning progress.",
        // Privacy Policy translations
        privacy_title: "Privacy Policy - SmartMem",
        privacy_meta_desc: "SmartMem Privacy Policy - Learn how we protect your personal information",
        privacy_intro_title: "Introduction",
        privacy_intro_content: "SmartMem (\"we\", \"our\", or \"this app\") values your privacy. This privacy policy explains our data processing practices. SmartMem is a completely local app, and we do not collect, store, or transmit any of your personal information.",
        privacy_no_collection_title: "We Do Not Collect Any Information",
        privacy_no_collection_content: "SmartMem is designed as a completely local application, which means:",
        privacy_no_personal: "We do not collect any personally identifiable information",
        privacy_no_account: "The app does not require account registration or personal information",
        privacy_no_analytics: "We do not collect usage statistics or analytics data",
        privacy_no_tracking: "We do not track your usage behavior",
        privacy_no_ads: "No ads in the app, no third-party tracking",
        privacy_local_storage_title: "Local Data Storage",
        privacy_local_storage_content: "All your learning data is securely stored on your device:",
        privacy_local_only: "All learning content and progress is stored locally on your device only",
        privacy_icloud_backup: "Automatically backed up through iOS system's iCloud backup feature (managed by Apple)",
        privacy_no_server: "We have no servers storing any of your data",
        privacy_full_control: "You have complete control over your data",
        privacy_no_sharing_title: "No Information Sharing",
        privacy_no_sharing_content: "Since we do not collect any information, therefore:",
        privacy_no_third_party: "We do not share data with any third parties",
        privacy_no_selling: "We do not sell any user information",
        privacy_no_marketing: "We do not use data for marketing purposes",
        privacy_apple_only: "Subscription information is only processed and managed by Apple",
        privacy_security_title: "Data Security",
        privacy_security_content: "Since all data is stored locally on your device, your information security depends on your device's security settings. We recommend keeping your device updated and using appropriate security measures.",
        privacy_rights_title: "Your Rights",
        privacy_rights_content: "Since we do not collect any personal information, traditional data rights (access, correction, deletion) are not applicable. However, you have complete control over all data stored locally on your device.",
        privacy_changes_title: "Policy Changes",
        privacy_changes_content: "We may update this privacy policy from time to time. Significant changes will be communicated through in-app notifications or email.",
        privacy_subscription_title: "Subscription Service Information",
        privacy_subscription_content: "SmartMem offers annual subscription service:",
        pricing_plans_title: "Subscription Plans and Pricing",
        pricing_yearly: "Annual Subscription: ¥128/year ($19.9/year)",
        pricing_note: "* Prices may vary by region. Actual prices are subject to App Store display in local currency. Subscriptions auto-renew and can be cancelled anytime. Subscription information is completely managed by Apple, and we cannot access your payment information."
    }
};

// Current language
let currentLanguage = 'zh';

// Language switching function
function switchLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);

    // Get current page info
    const currentPath = window.location.pathname;
    const currentPage = currentPath.split('/').pop();

    // For legal pages, redirect to the corresponding language URL
    if (currentPage.includes('privacy') || currentPage.includes('terms') || currentPage.includes('subscription') || currentPage.includes('support')) {
        let targetPage = '';

        if (currentPage.includes('privacy')) {
            targetPage = lang === 'en' ? 'privacy-en.html' : 'privacy.html';
        } else if (currentPage.includes('terms')) {
            targetPage = lang === 'en' ? 'terms-en.html' : 'terms.html';
        } else if (currentPage.includes('subscription')) {
            targetPage = lang === 'en' ? 'subscription-en.html' : 'subscription.html';
        } else if (currentPage.includes('support')) {
            targetPage = lang === 'en' ? 'support-en.html' : 'support.html';
        }

        // Always redirect to the target page (don't check if already on correct page)
        if (targetPage) {
            window.location.href = targetPage;
            return;
        }
    }

    // For main page (index.html), update content dynamically
    updatePageContent(lang);
}

// Function to update page content without redirecting
function updatePageContent(lang) {
    // Update HTML lang attribute
    document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';

    // Update all elements with data-i18n attribute
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[lang][key];
            } else if (element.hasAttribute('content')) {
                element.setAttribute('content', translations[lang][key]);
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    const activeBtn = document.querySelector(`[onclick="switchLanguage('${lang}')"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }

    // Update footer links based on language
    updateFooterLinks(lang);
}

// Update footer links based on language
function updateFooterLinks(lang) {
    const footerLinks = document.querySelectorAll('.footer-section ul li a');
    footerLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href) {
            if (href.includes('privacy')) {
                link.setAttribute('href', lang === 'en' ? 'privacy-en.html' : 'privacy.html');
            } else if (href.includes('terms')) {
                link.setAttribute('href', lang === 'en' ? 'terms-en.html' : 'terms.html');
            } else if (href.includes('subscription')) {
                link.setAttribute('href', lang === 'en' ? 'subscription-en.html' : 'subscription.html');
            } else if (href.includes('support')) {
                link.setAttribute('href', lang === 'en' ? 'support-en.html' : 'support.html');
            }
        }
    });

    // Update navigation support link
    const navSupportLink = document.querySelector('.nav-menu a[href*="support"]');
    if (navSupportLink) {
        navSupportLink.setAttribute('href', lang === 'en' ? 'support-en.html' : 'support.html');
    }
}

// Initialize language on page load
function initLanguage() {
    // Determine language based on current page URL
    const currentPath = window.location.pathname;
    const currentPage = currentPath.split('/').pop();

    let pageLanguage = 'zh'; // default to Chinese

    // If current page is an English page, set language to English
    if (currentPage.includes('-en.html')) {
        pageLanguage = 'en';
    }

    // Update current language and localStorage
    currentLanguage = pageLanguage;
    localStorage.setItem('language', pageLanguage);

    // Update page content without redirecting
    updatePageContent(pageLanguage);
}

// Smooth scrolling for navigation links
function initSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Mobile navigation toggle
function initMobileNav() {
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
                navToggle.classList.remove('active');
            });
        });
    }
}

// Navbar scroll effect
function initNavbarScroll() {
    const navbar = document.querySelector('.navbar');
    
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });
}

// Intersection Observer for animations
function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
            }
        });
    }, observerOptions);
    
    // Observe feature cards
    document.querySelectorAll('.feature-card').forEach(card => {
        observer.observe(card);
    });
}

// Form validation for contact forms
function validateForm(form) {
    const inputs = form.querySelectorAll('input[required], textarea[required]');
    let isValid = true;
    
    inputs.forEach(input => {
        if (!input.value.trim()) {
            input.classList.add('error');
            isValid = false;
        } else {
            input.classList.remove('error');
        }
        
        // Email validation
        if (input.type === 'email' && input.value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(input.value)) {
                input.classList.add('error');
                isValid = false;
            }
        }
    });
    
    return isValid;
}

// Initialize all functions when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initLanguage();
    initSmoothScrolling();
    initMobileNav();
    initNavbarScroll();
    initScrollAnimations();
    
    // Handle form submissions
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateForm(this)) {
                // Handle successful form submission
                console.log('Form submitted successfully');
                // You can add actual form submission logic here
            }
        });
    });
});

// Utility functions
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Export functions for use in other files
window.SmartMemApp = {
    switchLanguage,
    validateForm,
    debounce
};
